import{m as x,u as Q,cY as G,cZ as J,v as K,j as e,S as X,am as Y,an as Z,ci as z,cX as H,Q as u}from"./index-e0eec1b4.js";function V(){var f,N;const[a,I]=x.useState([]),[l,c]=x.useState([{months:3,chargePercentage:0}]),[p,h]=x.useState(""),{id:g}=Q(),{data:n,isLoading:_}=G(g),[$,{isLoading:j}]=J(),R=K();x.useEffect(()=>{n!=null&&n.data&&(h(n.data.bankName||""),c(n.data.emiOptions||[{months:3,chargePercentage:0}]))},[n]);const U=()=>{c([...l,{months:6,chargePercentage:0}])},q=s=>{l.length>1&&c(l.filter((r,i)=>i!==s))},b=(s,r,i)=>{const o=l.map((t,d)=>d===s?{...t,[r]:parseFloat(i)||0}:t);c(o)},F=async s=>{var d,v,y,E,k,w,C,O,P,B,M,S,L,A,D;s.preventDefault();const r=(d=a[0])==null?void 0:d.file;if(!p.trim())return u.error("Please enter bank name");if(l.some(m=>m.months<=0||m.chargePercentage<0))return u.error("Please enter valid EMI options");const i={bankName:p.trim(),emiOptions:l.filter(m=>m.months>0)},o=new FormData;(a==null?void 0:a.length)>0&&o.append("emi",r),o.append("data",JSON.stringify(i));const t=await $({formData:o,id:g});(v=t==null?void 0:t.data)!=null&&v.success?(u.success(((y=t==null?void 0:t.data)==null?void 0:y.message)||"Bank updated successfully"),R("/admin/ecommerce-setting/emi/all")):(u.error(Array.isArray((k=(E=t==null?void 0:t.error)==null?void 0:E.data)==null?void 0:k.error)&&((C=(w=t==null?void 0:t.error)==null?void 0:w.data)==null?void 0:C.error.length)>0?`${((B=(P=(O=t==null?void 0:t.error)==null?void 0:O.data)==null?void 0:P.error[0])==null?void 0:B.path)||""} ${((L=(S=(M=t==null?void 0:t.error)==null?void 0:M.data)==null?void 0:S.error[0])==null?void 0:L.message)||""}`.trim():((D=(A=t==null?void 0:t.error)==null?void 0:A.data)==null?void 0:D.message)||"Something went wrong!"),console.log(t))};return _?e.jsx(X,{}):e.jsxs("section",{className:"rounded bg-base-100 shadow md:w-[700px]",children:[e.jsx("div",{className:"border-b p-4 font-medium text-neutral",children:e.jsx("h3",{children:"Edit Bank EMI"})}),e.jsxs("form",{onSubmit:F,className:"flex flex-col gap-4 p-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"pb-2 text-sm font-medium text-neutral",children:"Bank Logo"}),e.jsx("p",{className:"pb-1 text-xs text-neutral-content",children:"Upload new logo or keep current one"}),e.jsx(Y,{value:a,onChange:s=>I(s),dataURLKey:"data_url",children:({onImageUpload:s,onImageRemove:r,dragProps:i})=>e.jsxs("div",{className:"w-max rounded border border-dashed p-4",...i,children:[e.jsxs("div",{className:"flex flex-col items-center gap-2 sm:flex-row",children:[e.jsx("span",{onClick:s,className:"cursor-pointer rounded-2xl bg-primary px-4 py-1.5 text-sm text-base-100",children:"Change Bank Logo"}),e.jsx("p",{className:"text-neutral-content",children:"or Drop here"})]}),e.jsx("div",{className:`${(a==null?void 0:a.length)>0&&"mt-4"} `,children:a==null?void 0:a.map((o,t)=>e.jsxs("div",{className:"image-item relative",children:[e.jsx("img",{src:o.data_url,alt:"",className:"h-20 w-32 rounded border object-contain"}),e.jsx("div",{onClick:()=>r(t),className:"absolute right-0 top-0 flex h-7 w-7 cursor-pointer items-center justify-center rounded-full bg-primary text-base-100",children:e.jsx(Z,{})})]},t))})]})}),((f=n==null?void 0:n.data)==null?void 0:f.logo)&&(a==null?void 0:a.length)===0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"mb-2 text-xs text-neutral-content",children:"Current Logo:"}),e.jsx("img",{src:`https://api.torayvinobd.store${(N=n==null?void 0:n.data)==null?void 0:N.logo}`,alt:"current logo",className:"h-20 w-32 rounded border object-contain"})]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("p",{className:"text-neutral-content",children:"Bank Name *"}),e.jsx("input",{type:"text",placeholder:"Enter Bank Name",className:"w-full rounded border px-3 py-2 text-sm outline-none",value:p,onChange:s=>h(s.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-medium text-neutral",children:"EMI Options *"}),e.jsxs("button",{type:"button",onClick:U,className:"hover:text-primary-focus flex items-center gap-1 text-sm text-primary",children:[e.jsx(z,{})," Add Option"]})]}),l.map((s,r)=>e.jsxs("div",{className:"mb-3 flex items-center gap-3 rounded border p-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"mb-1 text-xs text-neutral-content",children:"Months"}),e.jsx("input",{type:"number",placeholder:"Months",className:"w-full rounded border px-3 py-2 text-sm outline-none",value:s.months,onChange:i=>b(r,"months",i.target.value),min:"1",max:"60",required:!0})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"mb-1 text-xs text-neutral-content",children:"Charge Percentage (%)"}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Charge %",className:"w-full rounded border px-3 py-2 text-sm outline-none",value:s.chargePercentage,onChange:i=>b(r,"chargePercentage",i.target.value),min:"0",max:"100",required:!0})]}),e.jsx("button",{type:"button",onClick:()=>q(r),className:"p-2 text-red-500 hover:text-red-700 disabled:opacity-50",disabled:l.length===1,children:e.jsx(H,{})})]},r))]}),e.jsx("div",{className:"mt-6 flex justify-end border-t p-4",children:e.jsx("button",{disabled:j&&"disabled",className:"primary_btn",children:j?"Updating...":"Update Bank EMI"})})]})]})}export{V as default};
