import{u as ae,v as ne,aD as te,cp as ie,cq as le,cn as ce,co as de,j as s,S as xe,L as I,aE as me,c4 as L,cu as B,ag as R,cG as oe,Q as o}from"./index-e0eec1b4.js";import{D as he,a as re,b as ge,c as Y,d as je}from"./dropdown-menu-1f8f7033.js";import"./chevron-right-7d3e832d.js";function be(){var M,T,C,E,F,D,O,A,K;const q=ae().id,U=ne(),{data:b,isLoading:G}=te(q),e=b==null?void 0:b.data,S=((M=b==null?void 0:b.data)==null?void 0:M.products)||[],_=((T=b==null?void 0:b.data)==null?void 0:T.kits)||[],[Q]=ie(),z=async a=>{var n,m,c,r,x,h,g,j,d,i,u,N;const l=window.confirm("Do you want to delete this order?");try{if(l){const t=await Q(a);(n=t==null?void 0:t.data)!=null&&n.success?(o.success((m=t==null?void 0:t.data)==null?void 0:m.message),U("/admin/order/all-orders")):(o.error(`${((h=(x=(r=(c=t==null?void 0:t.error)==null?void 0:c.data)==null?void 0:r.error)==null?void 0:x[0])==null?void 0:h.message)||((d=(j=(g=t==null?void 0:t.error)==null?void 0:g.data)==null?void 0:j.error)==null?void 0:d.message)||((u=(i=t==null?void 0:t.error)==null?void 0:i.data)==null?void 0:u.message)||"Something went wrong!"}`),console.log(t))}}catch(t){o.error((N=t==null?void 0:t.data)==null?void 0:N.error),console.log(t)}},[V,{isLoading:H}]=le(),[J,{isLoading:W}]=ce(),[X,{isLoading:Z}]=de(),k=async()=>{var m,c,r,x,h,g,j,d,i,u,N,t,p,f,y,v,w,$,P;const l=[{invoice:e==null?void 0:e.invoiceNumber,cod_amount:(e==null?void 0:e.totalPrice)||0,recipient_name:(m=e==null?void 0:e.user)==null?void 0:m.name,recipient_phone:(c=e==null?void 0:e.user)==null?void 0:c.phone,recipient_address:((r=e==null?void 0:e.shippingInfo)==null?void 0:r.address)||"N/A",note:((x=e==null?void 0:e.shippingInfo)==null?void 0:x.note)||"N/A"}],n=await J(l);(h=n==null?void 0:n.data)!=null&&h.success?(o.success(((g=n==null?void 0:n.data)==null?void 0:g.message)||"Order sent successfully to Steadfast"),(d=(j=n==null?void 0:n.data)==null?void 0:j.stockAdjustment)!=null&&d.message&&o.success(`ðŸ“¦ ${(u=(i=n==null?void 0:n.data)==null?void 0:i.stockAdjustment)==null?void 0:u.message}`,{duration:4e3})):(o.error(`${((f=(p=(t=(N=n==null?void 0:n.error)==null?void 0:N.data)==null?void 0:t.error)==null?void 0:p[0])==null?void 0:f.message)||((w=(v=(y=n==null?void 0:n.error)==null?void 0:y.data)==null?void 0:v.error)==null?void 0:w.message)||((P=($=n==null?void 0:n.error)==null?void 0:$.data)==null?void 0:P.message)||"Something went wrong!"}`),console.log(n))},ee=async()=>{var n,m,c,r,x,h,g,j;o.loading("Processing order to Pathao...",{id:"pathao-single"});const l=[{invoiceNumber:e==null?void 0:e.invoiceNumber,totalPrice:(e==null?void 0:e.totalPrice)||0,recipient_name:((n=e==null?void 0:e.user)==null?void 0:n.name)||"Customer",recipient_phone:((m=e==null?void 0:e.user)==null?void 0:m.phone)||(e==null?void 0:e.phone)||"",recipient_address:((c=e==null?void 0:e.shippingInfo)==null?void 0:c.address)||(e==null?void 0:e.address)||"N/A",special_instruction:((r=e==null?void 0:e.shippingInfo)==null?void 0:r.note)||(e==null?void 0:e.note)||"",products:(e==null?void 0:e.products)||[],user:{name:(x=e==null?void 0:e.user)==null?void 0:x.name,phone:(h=e==null?void 0:e.user)==null?void 0:h.phone}}];try{const d=await X(l);o.dismiss("pathao-single");const i=d==null?void 0:d.data,{successful:u=0,failed:N=0,results:t=[]}=(i==null?void 0:i.data)||{};if(u>0&&(o.success("Order sent successfully to Pathao!"),(g=i==null?void 0:i.stockAdjustment)!=null&&g.message&&o.success(`ðŸ“¦ ${i.stockAdjustment.message}`,{duration:4e3})),N>0||t.some(p=>p.status==="failed"||p.status==="error")){const p=t==null?void 0:t.find(f=>f.status==="failed"||f.status==="error");if(p){let f=`Failed: ${p.message}`;if((j=p.error)!=null&&j.errors){const y=Object.entries(p.error.errors).map(([v,w])=>`${v}: ${w.join(", ")}`).join("; ");f+=` - ${y}`}o.error(f,{duration:8e3})}else o.error("Failed to send order to Pathao")}else!(i!=null&&i.success)&&t.length===0&&o.error((i==null?void 0:i.message)||"Failed to send order to Pathao");console.log("Pathao Response:",d)}catch(d){o.dismiss("pathao-single"),o.error("Error sending order: "+d.message),console.error(d)}};return G?s.jsx(xe,{}):s.jsxs("section",{children:[s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[s.jsxs(I,{to:"/admin/order/all-orders",className:"primary_btn flex w-max items-center gap-2 text-xs",children:[s.jsx(me,{})," Go Back"]}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-xs text-primary",children:"order/order-details"}),s.jsxs("p",{children:["Order: #",e==null?void 0:e._id]})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[!(e!=null&&e.tracking_code)&&(e==null?void 0:e.status)!=="shipped"&&(e==null?void 0:e.status)!=="delivered"&&s.jsxs(he,{children:[s.jsx(re,{children:W||Z?"Loading...":s.jsxs(L,{variant:"outline",children:["Send to Courier ",s.jsx(B,{className:"text-lg"})]})}),s.jsxs(ge,{className:"w-40",children:[s.jsx(Y,{children:s.jsxs("button",{onClick:ee,className:"flex items-center gap-2",children:[s.jsx("img",{src:"/images/pathao.png",alt:"Pathao",className:"w-6"}),"Pathao"]})}),s.jsx(je,{}),s.jsx(Y,{children:s.jsxs("button",{onClick:k,className:"flex items-center gap-2",children:[s.jsx("img",{src:"/images/steadfast.png",alt:"Steadfast",className:"w-6"}),"Steadfast"]})})]})]}),(e==null?void 0:e.tracking_code)&&(e==null?void 0:e.courierBy)==="Pathao"&&s.jsxs(L,{variant:"outline",onClick:()=>{var l;const a=`https://merchant.pathao.com/tracking?consignment_id=${e==null?void 0:e.tracking_code}&phone=${(l=e==null?void 0:e.user)==null?void 0:l.phone}`;window.open(a,"_blank","noopener,noreferrer")},className:"flex items-center gap-2",children:["Track Order ",s.jsx(B,{className:"text-lg"})]}),s.jsx("button",{onClick:()=>z(e==null?void 0:e._id),className:"whitespace-nowrap rounded bg-red-500 px-4 py-2 text-sm text-base-100",children:"Delete order"})]})]}),s.jsx("div",{className:"mt-4 rounded-md border bg-base-100 p-4",children:s.jsxs("div",{className:"flex flex-col items-start justify-between gap-3 sm:flex-row",children:[s.jsxs("div",{children:[s.jsxs("h2",{className:"text-xl",children:["Invoice INV-",e==null?void 0:e.invoiceNumber]}),s.jsx("p",{className:"mt-1 w-max rounded bg-green-100 px-2 py-1 text-[11px] text-primary",children:e==null?void 0:e.status}),s.jsxs("div",{className:"gap-2 sm:flex",children:[s.jsxs("p",{className:"mt-1 w-max rounded bg-primary/10 px-2 py-1 text-[11px] text-primary",children:["Placed On:"," ",R(e==null?void 0:e.createdAt).format("Do MMMM YYYY hh:mm a")]}),s.jsxs("p",{className:"mt-1 w-max rounded bg-primary/10 px-2 py-1 text-[11px] text-primary",children:["Updated:"," ",R(e==null?void 0:e.updatedAt).format("Do MMMM YYYY hh:mm a")]})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(I,{to:`/admin/order/print/${e==null?void 0:e._id}`,target:"_blank",className:"flex items-center gap-2 rounded border border-gray-400 px-2 py-1 text-sm text-neutral-content duration-200 hover:text-neutral",children:[s.jsx(oe,{className:"text-neutral"})," Print"]}),H?"Loading...":s.jsxs("select",{value:e==null?void 0:e.status,onChange:async a=>{var n,m,c;const l=await V({id:e==null?void 0:e._id,status:a.target.value});(n=l==null?void 0:l.data)!=null&&n.success?o.success("Status updated"):o.error(((c=(m=l==null?void 0:l.error)==null?void 0:m.data)==null?void 0:c.message)||"Something went wrong")},className:`cursor-pointer rounded border bg-transparent p-1 text-xs ${(e==null?void 0:e.status)=="pending"&&"border-yellow-500 text-yellow-500"} ${(e==null?void 0:e.status)=="shipped"&&"border-blue-400 text-blue-400"} ${(e==null?void 0:e.status)=="delivered"&&"border-green-400 text-green-400"} ${(e==null?void 0:e.status)=="cancelled"&&"border-red-400 text-red-400"}`,children:[s.jsx("option",{value:"pending",children:"Pending"}),s.jsx("option",{value:"shipped",children:"Shipped"}),s.jsx("option",{value:"delivered",children:"Delivered"}),s.jsx("option",{value:"cancelled",children:"Cancelled"})]})]})]})}),s.jsxs("div",{className:"mt-4 grid gap-4 sm:grid-cols-2 md:grid-cols-3",children:[s.jsxs("div",{className:"rounded-md border bg-base-100 p-2",children:[s.jsx("h2",{className:"text-lg font-medium",children:"Customer Info"}),s.jsxs("div",{className:"mt-3 flex flex-col gap-1 text-[15px] text-neutral",children:[s.jsxs("p",{children:["Name: ",(C=e==null?void 0:e.customer)==null?void 0:C.name]}),s.jsxs("p",{children:["Phone:",s.jsx(I,{to:`tel:${(E=e==null?void 0:e.customer)==null?void 0:E.phone}`,children:(F=e==null?void 0:e.customer)==null?void 0:F.phone})]}),s.jsxs("p",{children:["Email:",s.jsx(I,{to:`mailto:${(D=e==null?void 0:e.customer)==null?void 0:D.email}`,children:(O=e==null?void 0:e.customer)==null?void 0:O.email})]}),s.jsxs("p",{children:["Payment: ",e==null?void 0:e.paymentMethod]}),s.jsxs("p",{children:["Payment Status: ",e==null?void 0:e.paymentStatus]})]})]}),s.jsxs("div",{className:"rounded-md border bg-base-100 p-2",children:[s.jsx("h2",{className:"text-lg font-medium",children:"Shipping Address"}),s.jsx("div",{className:"mt-3 flex flex-col gap-1 text-[15px] text-neutral",children:s.jsx("p",{children:(A=e==null?void 0:e.shippingInfo)==null?void 0:A.address})})]}),s.jsxs("div",{className:"rounded-md border bg-base-100 p-2",children:[s.jsx("h2",{className:"text-lg font-medium",children:"Shipping Note"}),s.jsx("div",{className:"mt-3 flex flex-col gap-1 text-[15px] text-neutral",children:s.jsx("p",{children:(K=e==null?void 0:e.shippingInfo)==null?void 0:K.note})})]})]}),s.jsxs("div",{className:"mt-4 rounded-md border bg-base-100 p-4",children:[s.jsx("h2",{className:"text-lg",children:"Ordered Items"}),s.jsx("div",{className:"relative mt-2 overflow-x-auto rounded-md border",children:s.jsxs("table",{children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"SL"}),s.jsx("th",{children:"Product"}),s.jsx("th",{children:"Quantity"}),s.jsx("th",{children:"SKU"}),s.jsx("th",{children:"Discount"}),s.jsx("th",{children:"Price"}),s.jsx("th",{children:"Total"})]})}),s.jsxs("tbody",{children:[S==null?void 0:S.map((a,l)=>{var d,i,u,N,t,p,f,y,v,w,$;const n=(a==null?void 0:a.isBundleFree)===!0,m=a==null?void 0:a.sku,c=(i=(d=a==null?void 0:a.productId)==null?void 0:d.variant)==null?void 0:i.variants,r=(N=e==null?void 0:e.couponEligibleProductIds)==null?void 0:N.includes(String((u=a==null?void 0:a.productId)==null?void 0:u._id));let x=0,h=(a==null?void 0:a.discount)||0;if(n)x=0,h=0;else if(a!=null&&a.isVariant){const P=c==null?void 0:c.find(se=>se.sku==m);x=(P==null?void 0:P.price)??((t=a==null?void 0:a.productId)==null?void 0:t.price)}else x=(p=a==null?void 0:a.productId)==null?void 0:p.price;const g=n?0:Math.round(x-x*h/100),j=n?0:g*(a==null?void 0:a.quantity);return s.jsxs("tr",{className:r?"bg-green-50":"",children:[s.jsx("td",{children:l+1}),s.jsx("td",{children:s.jsxs(I,{to:`/product/${(f=a==null?void 0:a.productId)==null?void 0:f.slug}`,target:"_blank",className:"flex items-center gap-2",children:[s.jsx("img",{src:`https://api.torayvinobd.store/${(y=a==null?void 0:a.productId)==null?void 0:y.thumbnail}`,alt:(v=a==null?void 0:a.productId)==null?void 0:v.title,className:"h-10 w-10 rounded-full",loading:"lazy"}),s.jsxs("p",{children:[(w=a==null?void 0:a.productId)==null?void 0:w.title,n&&" - (Bundle Free Item)",r&&s.jsx("span",{className:"ml-2 rounded bg-green-600 px-2 py-0.5 text-xs text-white",children:"Coupon Applied"})]})]})}),s.jsx("td",{children:a==null?void 0:a.quantity}),s.jsx("td",{children:(a==null?void 0:a.sku)||"-"}),s.jsx("td",{children:n?"FREE":h?`${h}%`:"-"}),s.jsx("td",{children:s.jsxs("p",{children:[n?"FREE":g+"TK",!n&&h>0&&s.jsxs("del",{className:"text-sm text-red-500",children:[x,"TK"]})]})}),s.jsx("td",{children:n?"FREE":j+"TK"})]},`product-${($=a==null?void 0:a.productId)==null?void 0:$._id}-${l}`)}),_==null?void 0:_.map((a,l)=>{var g,j,d,i,u;const n=(a==null?void 0:a.isBundleFree)===!0,m=Number(a==null?void 0:a.price)||0,c=Number(a==null?void 0:a.discount)||0,r=Number(a==null?void 0:a.quantity)||1,x=n?0:Math.round(m-m*c/100),h=n?0:x*r;return s.jsxs("tr",{children:[s.jsx("td",{children:(S==null?void 0:S.length)+l+1}),s.jsx("td",{children:s.jsxs(I,{to:`/kit/${(g=a==null?void 0:a.kitId)==null?void 0:g.slug}`,target:"_blank",className:"flex items-center gap-2",children:[s.jsx("img",{src:`https://api.torayvinobd.store/${(j=a==null?void 0:a.kitId)==null?void 0:j.image}`,alt:(d=a==null?void 0:a.kitId)==null?void 0:d.name,className:"h-10 w-10 rounded-full",loading:"lazy"}),s.jsxs("p",{children:[(i=a==null?void 0:a.kitId)==null?void 0:i.name," (Kit)",n&&" - (Bundle Free Item)"]})]})}),s.jsx("td",{children:r}),s.jsx("td",{children:"-"}),s.jsx("td",{children:n?"FREE":c?`${c}%`:"-"}),s.jsx("td",{children:s.jsxs("p",{children:[n?"FREE":x+"TK",!n&&c>0&&s.jsxs("del",{className:"text-sm text-red-500",children:[m,"TK"]})]})}),s.jsx("td",{children:n?"FREE":h+"TK"})]},`kit-${(u=a==null?void 0:a.kitId)==null?void 0:u._id}-${l}`)})]}),s.jsxs("tfoot",{children:[s.jsxs("tr",{children:[s.jsx("td",{colSpan:6,className:"text-end",children:"SubTotal"}),s.jsxs("td",{children:[(e==null?void 0:e.totalPrice)-(e==null?void 0:e.shippingCharge)+((e==null?void 0:e.couponDiscount)||0),"TK"]})]}),s.jsxs("tr",{children:[s.jsx("td",{colSpan:6,className:"text-end",children:"Shipping Charge"}),s.jsxs("td",{children:[e==null?void 0:e.shippingCharge,"TK"]})]}),(e==null?void 0:e.couponCode)&&(e==null?void 0:e.couponDiscount)>0&&s.jsxs("tr",{className:"text-green-600",children:[s.jsxs("td",{colSpan:6,className:"text-end",children:["Coupon Discount (",e==null?void 0:e.couponCode,")"]}),s.jsxs("td",{children:["- ",e==null?void 0:e.couponDiscount,"TK"]})]}),s.jsxs("tr",{children:[s.jsx("th",{colSpan:6,className:"text-end",children:"Total"}),s.jsxs("th",{children:[e==null?void 0:e.totalPrice,"TK"]})]})]})]})})]})]})}export{be as default};
