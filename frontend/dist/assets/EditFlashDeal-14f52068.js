import{u as M,v as O,dj as R,m as u,c as U,dk as H,j as e,cI as J,Q as L}from"./index-e0eec1b4.js";function X(){var N,y,f;const{id:j}=M(),T=O(),{data:a,isLoading:C}=R(j),[d,h]=u.useState([]);u.useEffect(()=>{var s,t,i,c;((t=(s=a==null?void 0:a.data)==null?void 0:s.flashProducts)==null?void 0:t.length)>0&&h((c=(i=a==null?void 0:a.data)==null?void 0:i.flashProducts)==null?void 0:c.map(r=>r==null?void 0:r.product))},[a]);const{data:x}=U(),Q=x==null?void 0:x.data,[$,m]=u.useState([]),[B,{isLoading:b}]=H();u.useEffect(()=>{var s,t,i;((t=(s=a==null?void 0:a.data)==null?void 0:s.flashProducts)==null?void 0:t.length)>0&&m((i=a==null?void 0:a.data)==null?void 0:i.flashProducts)},[a]);const G=(s,t,i)=>{m(c=>{var o;const r=[...c];return r[s]||(r[s]=[]),r[s]={...r[s],product:(o=d[s])==null?void 0:o._id,[t]:i},r})},I=async s=>{var v,D,p,F,P,w,S,E,_,V;s.preventDefault();const t=s.target,i=t.title.value,c=t.startDate.value,r=t.endDate.value,o=($||[]).map((l,k)=>{var q;const g=d==null?void 0:d[k],z=g==null?void 0:g._id,A=typeof(l==null?void 0:l.product)=="string"?l.product:(q=l==null?void 0:l.product)==null?void 0:q._id;return{...l,product:z||A,discount:l==null?void 0:l.discount,discountType:(l==null?void 0:l.discountType)||"1"}}),n=await B({id:j,data:{title:i,startDate:c,endDate:r,flashProducts:o}});(v=n==null?void 0:n.data)!=null&&v.success?(L.success("Flash Deal updated successfully"),h([]),t.reset(),m([]),T("/admin/flash-deal")):(L.error(`${((P=(F=(p=(D=n==null?void 0:n.error)==null?void 0:D.data)==null?void 0:p.error)==null?void 0:F[0])==null?void 0:P.message)||((E=(S=(w=n==null?void 0:n.error)==null?void 0:w.data)==null?void 0:S.error)==null?void 0:E.message)||((V=(_=n==null?void 0:n.error)==null?void 0:_.data)==null?void 0:V.message)||"Something went wrong!"}`),console.log(n))};return C?e.jsx("p",{children:"Loading..."}):e.jsxs("section",{className:"rounded bg-base-100 p-3 text-neutral",children:[e.jsx("p",{children:"Flash Deal Information"}),e.jsxs("form",{onSubmit:I,className:"mx-auto mt-6 flex flex-col gap-4 text-sm xl:w-2/3",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("p",{children:"Title"}),e.jsx("input",{type:"text",className:"rounded border px-4 py-1 outline-none",name:"title",defaultValue:(N=a==null?void 0:a.data)==null?void 0:N.title,required:!0})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("p",{children:"Start Date"}),e.jsx("input",{type:"date",className:"rounded border px-4 py-1 outline-none",name:"startDate",defaultValue:(y=a==null?void 0:a.data)==null?void 0:y.startDate,required:!0})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("p",{children:"End Date"}),e.jsx("input",{type:"date",className:"rounded border px-4 py-1 outline-none",name:"endDate",defaultValue:(f=a==null?void 0:a.data)==null?void 0:f.endDate,required:!0})]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("p",{children:"Products"}),e.jsx(J,{multi:!0,options:Q,labelField:"title",valueField:"_id",onChange:s=>h(s),values:d})]}),(d==null?void 0:d.length)>0&&e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("p",{children:"Discounts"}),e.jsx("div",{className:"relative overflow-x-auto shadow-lg",children:e.jsxs("table",{className:"dashboard_table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border-b border-r bg-gray-100",children:"Product"}),e.jsx("th",{className:"border-b border-r bg-gray-100",children:"Base Price"}),e.jsx("th",{className:"border-b border-r bg-gray-100",children:"Discount"}),e.jsx("th",{className:"border-b bg-gray-100",children:"Discount Type"})]})}),e.jsx("tbody",{children:d==null?void 0:d.map((s,t)=>{var i,c;return e.jsxs("tr",{children:[e.jsx("td",{className:"border-r",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:`https://api.torayvinobd.store/products/${s==null?void 0:s.thumbnail}`,alt:"",className:"h-8 w-8 rounded"}),e.jsx("p",{children:s==null?void 0:s.title})]})}),e.jsx("td",{className:"border-r",children:e.jsx("p",{children:s==null?void 0:s.sellingPrice})}),e.jsx("td",{className:"border-r",children:e.jsx("input",{type:"number",className:"w-28 rounded border px-4 py-1 outline-none",onChange:r=>G(t,"discount",r.target.value),required:!0,defaultValue:(c=(i=a==null?void 0:a.data)==null?void 0:i.flashProducts[t])==null?void 0:c.discount})}),e.jsx("td",{children:e.jsx("input",{type:"text",defaultValue:"%",disabled:!0,className:"bg-base-100"})})]},s==null?void 0:s._id)})})]})})]}),e.jsx("div",{children:e.jsx("button",{disabled:b&&"disabled",className:"primary_btn",children:b?"Loading...":"Save"})})]})]})}export{X as default};
