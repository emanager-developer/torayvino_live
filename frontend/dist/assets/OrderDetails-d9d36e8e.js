import{u as as,y as ns,aE as ts,cp as is,cq as ls,cn as cs,co as ds,j as e,S as xs,L as v,aF as ms,c5 as L,cu as B,aj as R,cG as hs,Q as x}from"./index-f981d823.js";import{D as os,a as rs,b as gs,c as Y,d as js}from"./dropdown-menu-e69bdeea.js";import"./chevron-right-9544761f.js";function bs(){var _,M,T,C,E,F,D,O,A;const q=as().id,U=ns(),{data:p,isLoading:G}=ts(q),s=p==null?void 0:p.data,y=((_=p==null?void 0:p.data)==null?void 0:_.products)||[],I=((M=p==null?void 0:p.data)==null?void 0:M.kits)||[],[Q]=is(),z=async a=>{var n,d,c,h;const l=window.confirm("Do you want to delete this order?");try{if(l){const t=await Q(a);(n=t==null?void 0:t.data)!=null&&n.success?(x.success((d=t==null?void 0:t.data)==null?void 0:d.message),U("/admin/order/all-orders")):(x.error(((c=t==null?void 0:t.data)==null?void 0:c.message)||"Something went wrong"),console.log(t))}}catch(t){x.error((h=t==null?void 0:t.data)==null?void 0:h.error),console.log(t)}},[V,{isLoading:H}]=ls(),[J,{isLoading:W}]=cs(),[X,{isLoading:Z}]=ds(),k=async()=>{var d,c,h,t,o,r,g,m,i,j,b;const l=[{invoice:s==null?void 0:s.invoiceNumber,cod_amount:(s==null?void 0:s.totalPrice)||0,recipient_name:(d=s==null?void 0:s.user)==null?void 0:d.name,recipient_phone:(c=s==null?void 0:s.user)==null?void 0:c.phone,recipient_address:((h=s==null?void 0:s.shippingInfo)==null?void 0:h.address)||"N/A",note:((t=s==null?void 0:s.shippingInfo)==null?void 0:t.note)||"N/A"}],n=await J(l);(o=n==null?void 0:n.data)!=null&&o.success?(x.success(((r=n==null?void 0:n.data)==null?void 0:r.message)||"Order sent successfully to Steadfast"),(m=(g=n==null?void 0:n.data)==null?void 0:g.stockAdjustment)!=null&&m.message&&x.success(`ðŸ“¦ ${(j=(i=n==null?void 0:n.data)==null?void 0:i.stockAdjustment)==null?void 0:j.message}`,{duration:4e3})):(x.error(((b=n==null?void 0:n.data)==null?void 0:b.message)||"Failed to send order to Steadfast"),console.log(n))},ss=async()=>{var n,d,c,h,t,o,r,g;x.loading("Processing order to Pathao...",{id:"pathao-single"});const l=[{invoiceNumber:s==null?void 0:s.invoiceNumber,totalPrice:(s==null?void 0:s.totalPrice)||0,recipient_name:((n=s==null?void 0:s.user)==null?void 0:n.name)||"Customer",recipient_phone:((d=s==null?void 0:s.user)==null?void 0:d.phone)||(s==null?void 0:s.phone)||"",recipient_address:((c=s==null?void 0:s.shippingInfo)==null?void 0:c.address)||(s==null?void 0:s.address)||"N/A",special_instruction:((h=s==null?void 0:s.shippingInfo)==null?void 0:h.note)||(s==null?void 0:s.note)||"",products:(s==null?void 0:s.products)||[],user:{name:(t=s==null?void 0:s.user)==null?void 0:t.name,phone:(o=s==null?void 0:s.user)==null?void 0:o.phone}}];try{const m=await X(l);x.dismiss("pathao-single");const i=m==null?void 0:m.data,{successful:j=0,failed:b=0,results:f=[]}=(i==null?void 0:i.data)||{};if(j>0&&(x.success("Order sent successfully to Pathao!"),(r=i==null?void 0:i.stockAdjustment)!=null&&r.message&&x.success(`ðŸ“¦ ${i.stockAdjustment.message}`,{duration:4e3})),b>0||f.some(u=>u.status==="failed"||u.status==="error")){const u=f==null?void 0:f.find(N=>N.status==="failed"||N.status==="error");if(u){let N=`Failed: ${u.message}`;if((g=u.error)!=null&&g.errors){const w=Object.entries(u.error.errors).map(([S,P])=>`${S}: ${P.join(", ")}`).join("; ");N+=` - ${w}`}x.error(N,{duration:8e3})}else x.error("Failed to send order to Pathao")}else!(i!=null&&i.success)&&f.length===0&&x.error((i==null?void 0:i.message)||"Failed to send order to Pathao");console.log("Pathao Response:",m)}catch(m){x.dismiss("pathao-single"),x.error("Error sending order: "+m.message),console.error(m)}};return G?e.jsx(xs,{}):e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[e.jsxs(v,{to:"/admin/order/all-orders",className:"primary_btn flex w-max items-center gap-2 text-xs",children:[e.jsx(ms,{})," Go Back"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xs text-primary",children:"order/order-details"}),e.jsxs("p",{children:["Order: #",s==null?void 0:s._id]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!(s!=null&&s.tracking_code)&&(s==null?void 0:s.status)!=="shipped"&&(s==null?void 0:s.status)!=="delivered"&&e.jsxs(os,{children:[e.jsx(rs,{children:W||Z?"Loading...":e.jsxs(L,{variant:"outline",children:["Send to Courier ",e.jsx(B,{className:"text-lg"})]})}),e.jsxs(gs,{className:"w-40",children:[e.jsx(Y,{children:e.jsxs("button",{onClick:ss,className:"flex items-center gap-2",children:[e.jsx("img",{src:"/images/pathao.png",alt:"Pathao",className:"w-6"}),"Pathao"]})}),e.jsx(js,{}),e.jsx(Y,{children:e.jsxs("button",{onClick:k,className:"flex items-center gap-2",children:[e.jsx("img",{src:"/images/steadfast.png",alt:"Steadfast",className:"w-6"}),"Steadfast"]})})]})]}),(s==null?void 0:s.tracking_code)&&(s==null?void 0:s.courierBy)==="Pathao"&&e.jsxs(L,{variant:"outline",onClick:()=>{var l;const a=`https://merchant.pathao.com/tracking?consignment_id=${s==null?void 0:s.tracking_code}&phone=${(l=s==null?void 0:s.user)==null?void 0:l.phone}`;window.open(a,"_blank","noopener,noreferrer")},className:"flex items-center gap-2",children:["Track Order ",e.jsx(B,{className:"text-lg"})]}),e.jsx("button",{onClick:()=>z(s==null?void 0:s._id),className:"whitespace-nowrap rounded bg-red-500 px-4 py-2 text-sm text-base-100",children:"Delete order"})]})]}),e.jsx("div",{className:"mt-4 rounded-md border bg-base-100 p-4",children:e.jsxs("div",{className:"flex flex-col items-start justify-between gap-3 sm:flex-row",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl",children:["Invoice INV-",s==null?void 0:s.invoiceNumber]}),e.jsx("p",{className:"mt-1 w-max rounded bg-green-100 px-2 py-1 text-[11px] text-primary",children:s==null?void 0:s.status}),e.jsxs("div",{className:"gap-2 sm:flex",children:[e.jsxs("p",{className:"mt-1 w-max rounded bg-primary/10 px-2 py-1 text-[11px] text-primary",children:["Placed On:"," ",R(s==null?void 0:s.createdAt).format("Do MMMM YYYY hh:mm a")]}),e.jsxs("p",{className:"mt-1 w-max rounded bg-primary/10 px-2 py-1 text-[11px] text-primary",children:["Updated:"," ",R(s==null?void 0:s.updatedAt).format("Do MMMM YYYY hh:mm a")]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(v,{to:`/admin/order/print/${s==null?void 0:s._id}`,target:"_blank",className:"flex items-center gap-2 rounded border border-gray-400 px-2 py-1 text-sm text-neutral-content duration-200 hover:text-neutral",children:[e.jsx(hs,{className:"text-neutral"})," Print"]}),H?"Loading...":e.jsxs("select",{value:s==null?void 0:s.status,onChange:async a=>{var n,d,c;const l=await V({id:s==null?void 0:s._id,status:a.target.value});(n=l==null?void 0:l.data)!=null&&n.success?x.success("Status updated"):x.error(((c=(d=l==null?void 0:l.error)==null?void 0:d.data)==null?void 0:c.message)||"Something went wrong")},className:`cursor-pointer rounded border bg-transparent p-1 text-xs ${(s==null?void 0:s.status)=="pending"&&"border-yellow-500 text-yellow-500"} ${(s==null?void 0:s.status)=="shipped"&&"border-blue-400 text-blue-400"} ${(s==null?void 0:s.status)=="delivered"&&"border-green-400 text-green-400"} ${(s==null?void 0:s.status)=="cancelled"&&"border-red-400 text-red-400"}`,children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]})]})}),e.jsxs("div",{className:"mt-4 grid gap-4 sm:grid-cols-2 md:grid-cols-3",children:[e.jsxs("div",{className:"rounded-md border bg-base-100 p-2",children:[e.jsx("h2",{className:"text-lg font-medium",children:"Customer Info"}),e.jsxs("div",{className:"mt-3 flex flex-col gap-1 text-[15px] text-neutral",children:[e.jsxs("p",{children:["Name: ",(T=s==null?void 0:s.customer)==null?void 0:T.name]}),e.jsxs("p",{children:["Phone:",e.jsx(v,{to:`tel:${(C=s==null?void 0:s.customer)==null?void 0:C.phone}`,children:(E=s==null?void 0:s.customer)==null?void 0:E.phone})]}),e.jsxs("p",{children:["Email:",e.jsx(v,{to:`mailto:${(F=s==null?void 0:s.customer)==null?void 0:F.email}`,children:(D=s==null?void 0:s.customer)==null?void 0:D.email})]}),e.jsxs("p",{children:["Payment: ",s==null?void 0:s.paymentMethod]}),e.jsxs("p",{children:["Payment Status: ",s==null?void 0:s.paymentStatus]})]})]}),e.jsxs("div",{className:"rounded-md border bg-base-100 p-2",children:[e.jsx("h2",{className:"text-lg font-medium",children:"Shipping Address"}),e.jsx("div",{className:"mt-3 flex flex-col gap-1 text-[15px] text-neutral",children:e.jsx("p",{children:(O=s==null?void 0:s.shippingInfo)==null?void 0:O.address})})]}),e.jsxs("div",{className:"rounded-md border bg-base-100 p-2",children:[e.jsx("h2",{className:"text-lg font-medium",children:"Shipping Note"}),e.jsx("div",{className:"mt-3 flex flex-col gap-1 text-[15px] text-neutral",children:e.jsx("p",{children:(A=s==null?void 0:s.shippingInfo)==null?void 0:A.note})})]})]}),e.jsxs("div",{className:"mt-4 rounded-md border bg-base-100 p-4",children:[e.jsx("h2",{className:"text-lg",children:"Ordered Items"}),e.jsx("div",{className:"relative mt-2 overflow-x-auto rounded-md border",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"SL"}),e.jsx("th",{children:"Product"}),e.jsx("th",{children:"Quantity"}),e.jsx("th",{children:"SKU"}),e.jsx("th",{children:"Discount"}),e.jsx("th",{children:"Price"}),e.jsx("th",{children:"Total"})]})}),e.jsxs("tbody",{children:[y==null?void 0:y.map((a,l)=>{var m,i,j,b,f,u,N,w,S,P,K;const n=(a==null?void 0:a.isBundleFree)===!0,d=a==null?void 0:a.sku,c=(i=(m=a==null?void 0:a.productId)==null?void 0:m.variant)==null?void 0:i.variants,h=(b=s==null?void 0:s.couponEligibleProductIds)==null?void 0:b.includes(String((j=a==null?void 0:a.productId)==null?void 0:j._id));let t=0,o=(a==null?void 0:a.discount)||0;if(n)t=0,o=0;else if(a!=null&&a.isVariant){const $=c==null?void 0:c.find(es=>es.sku==d);t=($==null?void 0:$.price)??((f=a==null?void 0:a.productId)==null?void 0:f.price)}else t=(u=a==null?void 0:a.productId)==null?void 0:u.price;const r=n?0:Math.round(t-t*o/100),g=n?0:r*(a==null?void 0:a.quantity);return e.jsxs("tr",{className:h?"bg-green-50":"",children:[e.jsx("td",{children:l+1}),e.jsx("td",{children:e.jsxs(v,{to:`/product/${(N=a==null?void 0:a.productId)==null?void 0:N.slug}`,target:"_blank",className:"flex items-center gap-2",children:[e.jsx("img",{src:`https://api.torayvinobd.store/${(w=a==null?void 0:a.productId)==null?void 0:w.thumbnail}`,alt:(S=a==null?void 0:a.productId)==null?void 0:S.title,className:"h-10 w-10 rounded-full",loading:"lazy"}),e.jsxs("p",{children:[(P=a==null?void 0:a.productId)==null?void 0:P.title,n&&" - (Bundle Free Item)",h&&e.jsx("span",{className:"ml-2 rounded bg-green-600 px-2 py-0.5 text-xs text-white",children:"Coupon Applied"})]})]})}),e.jsx("td",{children:a==null?void 0:a.quantity}),e.jsx("td",{children:(a==null?void 0:a.sku)||"-"}),e.jsx("td",{children:n?"FREE":o?`${o}%`:"-"}),e.jsx("td",{children:e.jsxs("p",{children:[n?"FREE":r+"TK",!n&&o>0&&e.jsxs("del",{className:"text-sm text-red-500",children:[t,"TK"]})]})}),e.jsx("td",{children:n?"FREE":g+"TK"})]},`product-${(K=a==null?void 0:a.productId)==null?void 0:K._id}-${l}`)}),I==null?void 0:I.map((a,l)=>{var r,g,m,i,j;const n=(a==null?void 0:a.isBundleFree)===!0,d=Number(a==null?void 0:a.price)||0,c=Number(a==null?void 0:a.discount)||0,h=Number(a==null?void 0:a.quantity)||1,t=n?0:Math.round(d-d*c/100),o=n?0:t*h;return e.jsxs("tr",{children:[e.jsx("td",{children:(y==null?void 0:y.length)+l+1}),e.jsx("td",{children:e.jsxs(v,{to:`/kit/${(r=a==null?void 0:a.kitId)==null?void 0:r.slug}`,target:"_blank",className:"flex items-center gap-2",children:[e.jsx("img",{src:`https://api.torayvinobd.store/${(g=a==null?void 0:a.kitId)==null?void 0:g.image}`,alt:(m=a==null?void 0:a.kitId)==null?void 0:m.name,className:"h-10 w-10 rounded-full",loading:"lazy"}),e.jsxs("p",{children:[(i=a==null?void 0:a.kitId)==null?void 0:i.name," (Kit)",n&&" - (Bundle Free Item)"]})]})}),e.jsx("td",{children:h}),e.jsx("td",{children:"-"}),e.jsx("td",{children:n?"FREE":c?`${c}%`:"-"}),e.jsx("td",{children:e.jsxs("p",{children:[n?"FREE":t+"TK",!n&&c>0&&e.jsxs("del",{className:"text-sm text-red-500",children:[d,"TK"]})]})}),e.jsx("td",{children:n?"FREE":o+"TK"})]},`kit-${(j=a==null?void 0:a.kitId)==null?void 0:j._id}-${l}`)})]}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:6,className:"text-end",children:"SubTotal"}),e.jsxs("td",{children:[(s==null?void 0:s.totalPrice)-(s==null?void 0:s.shippingCharge)+((s==null?void 0:s.couponDiscount)||0),"TK"]})]}),e.jsxs("tr",{children:[e.jsx("td",{colSpan:6,className:"text-end",children:"Shipping Charge"}),e.jsxs("td",{children:[s==null?void 0:s.shippingCharge,"TK"]})]}),(s==null?void 0:s.couponCode)&&(s==null?void 0:s.couponDiscount)>0&&e.jsxs("tr",{className:"text-green-600",children:[e.jsxs("td",{colSpan:6,className:"text-end",children:["Coupon Discount (",s==null?void 0:s.couponCode,")"]}),e.jsxs("td",{children:["- ",s==null?void 0:s.couponDiscount,"TK"]})]}),e.jsxs("tr",{children:[e.jsx("th",{colSpan:6,className:"text-end",children:"Total"}),e.jsxs("th",{children:[s==null?void 0:s.totalPrice,"TK"]})]})]})]})})]})]})}export{bs as default};
